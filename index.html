<!DOCTYPE html>
<html>
<head>
	<title>מפה מוערת - ואדי היובל</title>

	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes" />

	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

 	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />

	
	<style type="text/css">
		body {
		    padding: 0;
		    margin: 0;
		}

		html, body, #map {
		    height: 100%;
		}

		.photo {
			width: 100px;
		}
	</style>

</head>
<body>
	<div id="map">I AM MAP</div>

	<script src="data/items.js"></script>
	<script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>
	
	<script type="text/javascript">

		// define marker icon
		var milkIcon = L.icon({
	    	iconUrl		: 'img/TipatHalavIcon40x25.png',
		    iconSize	: [25, 40],
		    iconAnchor	: [13, 39],
		    popupAnchor	: [0, -35]
		});

		// run for each marker
		function onEachFeature(feature, layer) {
			// console.log(layer);

			marker_html ='<div style="text-align: center">';
			marker_html += '<img class="photo" src="' + feature.properties.image + '" /><br />';
			if (typeof feature.properties.text !== 'undefined' )
				marker_html += feature.properties.text;
			marker_html +='</div>';

			layer.bindPopup(marker_html);
		}

		// initial setup
		var MAP_CENTER = [31.763, 35.179];
		var DEFAULT_ZOOM = 18;
		
		var map = L.map('map', { scrollWheelZoom: true }).setView(MAP_CENTER, DEFAULT_ZOOM);

		// map.locate({setView : true, maxZoom: 13});

		tile_url = 'http://{s}.tiles.mapbox.com/v3/mareemakom.i2gaoa1o/{z}/{x}/{y}.png';

		L.tileLayer(tile_url, {
			attribution: '<a href="https://github.com/niryariv/yuvalim">קוד</a>',
			maxZoom: 22,
			minZoom: 17
		}).addTo(map);

		L.geoJson(items,
			{
				pointToLayer: function (feature, latlng) {
		        	return L.marker(latlng, {icon: milkIcon});
		    	},

				filter: function(feature, layer) {
			        return !feature.properties.error;
			    },
				onEachFeature: onEachFeature,
			}
		).addTo(map);
	</script>
</body>
</html>
